(function(){var f,e,d,h,b,a,c={}.hasOwnProperty,g=function(l,j){for(var i in j){if(c.call(j,i)){l[i]=j[i]}}function k(){this.constructor=l}k.prototype=j.prototype;l.prototype=new k();l.__super__=j.prototype;return l};h=(function(){function i(){}i.prototype.validate=function(j){if(j.length===0){throw"Timeseries expects an array of data."}if(j[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof j[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};i.prototype.timestamp=function(p,q,n){var l,m,k,o,j;if(q==null){q=new Date().getTime()}if(n==null){n=60000}l=0;m=[];for(o=0,j=p.length;o<j;o++){k=p[o];m.push([q+(l++*n),k])}return m};i.prototype.wrap=function(j){this.validate(j);return new d(j)};i.prototype.numeric=function(j){this.validate(j);if(typeof j[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}return new e(j)};i.prototype.multi=function(j){this.validate(j);return new f(j)};i.prototype.build=function(j){this.validate(j);if(typeof j[0][1]==="number"){return this.numeric(j)}else{if(typeof j[0][1]==="string"){return this.wrap(j)}else{return this.multi(j)}}};return i})();b=new h();d=(function(){function i(j){this.data=j;this.listeners=[]}i.prototype.size=function(){return this.data.length};i.prototype.length=function(){return this.data.length};i.prototype.count=function(){return this.data.length};i.prototype.first=function(){return this.data[0]};i.prototype.last=function(){return this.data[this.size()-1]};i.prototype.sample=function(j){return this.data[j]};i.prototype.time=function(j){return this.data[j][0]};i.prototype.value=function(j){return this.data[j][1]};i.prototype.domain=function(){return[this.first()[0],this.last()[0]]};i.prototype.shift=function(){var j;j=this.data.shift();this.notify();return j};i.prototype.append=function(k,j){if(k<this.end()){throw"Can't append sample with past timestamp"}this.data.push([k,j]);return this.notify()};i.prototype.notify=function(){var n,m,k,l,j;l=this.listeners;j=[];for(m=0,k=l.length;m<k;m++){n=l[m];j.push(n())}return j};i.prototype.listen=function(j){return this.listeners.push(j)};i.prototype.values=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(l)}return n};i.prototype.duration=function(){return this.end()-this.start()};i.prototype.start=function(){return this.first()[0]};i.prototype.end=function(){return this.last()[0]};i.prototype.scan=function(m,l){var k,j;k=this.nearest(m);j=this.nearest(l);if(this.time(k)<m){++k}if(this.time(j)<l){++j}return new this.constructor(this.data.slice(k,j))};i.prototype.filter=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];if(l(k[0],k[1])){m.push(k)}}return new this.constructor(m)};i.prototype.split=function(p){var l,k,m,o,j,n;l=[];k=[];n=this.data;for(o=0,j=n.length;o<j;o++){m=n[o];if(m[0]<=p){l.push(m)}else{k.push(m)}}return[new this.constructor(l),new this.constructor(k)]};i.prototype.map=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];m.push(l(k[0],k[1]))}return new this.constructor(m)};i.prototype.timestamps=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(m)}return n};i.prototype.nearest=function(j){return this.bsearch(j,0,this.size()-1)};i.prototype.bsearch=function(m,l,j){var o,n,k;k=Math.floor((j-l)/2)+l;if(l===k){o=Math.abs(this.time(l)-m);n=Math.abs(this.time(j)-m);if(n>o){return l}else{return j}}else{if(m<this.time(k)){return this.bsearch(m,l,k)}else{if(m>this.time(k)){return this.bsearch(m,k,j)}else{return k}}}};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return i})();e=(function(j){g(i,j);function i(k){this.data=k;i.__super__.constructor.call(this,this.data)}i.prototype.statistics=function(){var q,n,p,l,u,s,m,r,o,k;if(this._stats){return this._stats}p=0;l=0;n=Infinity;q=-Infinity;o=this.data;for(m=0,r=o.length;m<r;m++){k=o[m],u=k[0],s=k[1];p+=s;l+=s*s;if(s>q){q=s}if(s<n){n=s}}return this._stats={sum:p,min:n,max:q,sum2:l}};i.prototype.shift=function(){var s,u,q,y,x,p,o,w,k,r,n,m,l;s=this.data.shift();x=s[1];if(this._stats){this._stats.sum-=x;this._stats.sum2-=x*x;if(x===this._stats.min){q=Infinity;r=this.data;for(p=0,w=r.length;p<w;p++){n=r[p],y=n[0],x=n[1];q=Math.min(x,q)}this._stats.min=q}if(x===this._stats.max){u=-Infinity;m=this.data;for(o=0,k=m.length;o<k;o++){l=m[o],y=l[0],x=l[1];u=Math.min(x,u)}this._stats.max=u}}this.notify();return s};i.prototype.append=function(l,k){if(l<this.end()){throw"Can't append sample with past timestamp"}if(this._stats){this._stats.sum+=k;this._stats.sum2+=k*k;this._stats.min=Math.min(this._stats.min,k);this._stats.max=Math.max(this._stats.max,k)}return i.__super__.append.call(this,l,k)};i.prototype.sum=function(){return this.statistics().sum};i.prototype.sumsq=function(){return this.statistics().sum2};i.prototype.variance=function(){var u,p,o,m,s,l,q,k;p=0;q=this.data;for(s=0,l=q.length;s<l;s++){k=q[s],o=k[0],m=k[1];u=m-this.mean();p+=u*u}return p/(this.size()-1)};i.prototype.stddev=function(){return Math.sqrt((this.sumsq()/this.size())/(this.mean()*this.mean()))};i.prototype.mean=function(){return this.sum()/this.size()};i.prototype.range=function(){return[this.min(),this.max()]};i.prototype.span=function(){return this.max()-this.min()};i.prototype.min=function(){return this.statistics().min};i.prototype.max=function(){return this.statistics().max};i.prototype.values=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(m)}return o};i.prototype.valuesSorted=function(){if(this._valuesSorted){return this._valuesSorted}return this._valuesSorted=this.values().sort(function(l,k){return l-k})};i.prototype.median=function(){var k;k=Math.floor(this.size()/2);if(this.size()%2){return this.valuesSorted()[k]}else{return(this.valuesSorted()[k-1]+this.valuesSorted()[k])/2}};i.prototype.rollup=function(m,q){var l,w,u,p,s,n,r,o,k;w=[];p=this.start();l=[];o=this.data;for(n=0,r=o.length;n<r;n++){k=o[n],u=k[0],s=k[1];if(u-p>=m){w.push([p,q(p,l)]);l=[];p=u}l.push(s)}if(l.length>0){w.push([p,q(p,l)])}return new this.constructor(w)};i.prototype.norms=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push((m-this.mean())/this.stddev())}return o};i.prototype.simplify=function(k){var p,o,m,n,s,l,q;if(k==null){k=0.1}p=this.first();m=this.max()-this.min();o=[p];q=this.data;for(s=0,l=q.length;s<l;s++){n=q[s];if(((Math.abs(n[1]-p[1]))/m)>k){if(p[0]!==o[o.length-1][0]){o.push(p)}o.push(n)}p=n}if(p[0]!==o[o.length-1][0]){o.push(p)}return new d(o)};i.prototype.match=function(q){var m,l,p,s,r,k,n,o;if(!(q instanceof d)){throw"Must match against a Timeseries object"}m=999999999;s=-1;r=q.norms();k=this.norms();if(!(r.length<=k.length)){throw"Query length exceeds source length"}for(p=n=0,o=k.length-r.length-1;0<=o?n<=o:n>=o;p=0<=o?++n:--n){l=this._distance(r,k.slice(p,+(p+r.length)+1||9000000000));if(l<m){m=l;s=p}}return s};i.prototype._distance=function(l,k){var q,m,n,p,o;if(l.length!==k.length){throw"Array lengths must match for distance"}n=0;for(m=p=0,o=l.length-1;0<=o?p<=o:p>=o;m=0<=o?++p:--p){q=k[m]-l[m];n+=q*q}return Math.sqrt(n)};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return i})(d);f=(function(j){g(i,j);function i(n){var s,r,q,m,p,o,l,k;this.data=n;i.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];o=n[0][1];for(s in o){q=o[s];this.attrs.push(s);this.lookup[s]=[]}for(m=0,p=n.length;m<p;m++){r=n[m];l=r[1];for(s in l){q=l[s];this.lookup[s].push([r[0],q])}}k=this.lookup;for(s in k){q=k[s];if(typeof this.lookup[s][0][1]==="number"){this.lookup[s]=b.numeric(this.lookup[s])}else{this.lookup[s]=b.multi(this.lookup[s])}}}i.prototype.series=function(k){var l,m;if(k[0]==="/"){return this.series(k.substr(1))}if(k.indexOf("/")>0){m=k.split("/");l=m.shift();if(!this.lookup[l]){throw"Can't get attribute "+l+" of multi time series"}return this.lookup[l].series(m.join("/"))}if(!this.lookup[k]){throw"Can't get attribute "+k+" of multi time series"}return this.lookup[k]};i.prototype.append=function(m,k){var l,n;for(l in k){n=k[l];this.lookup[l].append(m,n)}return i.__super__.append.call(this,m,k)};i.prototype.shift=function(){var k,n,l,m;m=this.attrs;for(n=0,l=m.length;n<l;n++){k=m[n];this.lookup[k].shift()}return i.__super__.shift.call(this)};i.prototype.attr=function(k){return this.series(k)};return i})(d);a=typeof module!=="undefined"&&module.exports?module.exports:window;a.$ts=b}).call(this);