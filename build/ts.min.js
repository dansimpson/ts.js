(function(){var c,e,a,f,i,d,h,g={}.hasOwnProperty,b=function(m,k){for(var j in k){if(g.call(k,j)){m[j]=k[j]}}function l(){this.constructor=m}l.prototype=k.prototype;m.prototype=new l();m.__super__=k.prototype;return m};i=(function(){function j(){}j.prototype.validate=function(k){if(k.length===0){throw"Timeseries expects an array of data."}if(k[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof k[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};j.prototype.timestamp=function(q,s,o){var m,n,l,p,k;if(s==null){s=new Date().getTime()}if(o==null){o=60000}m=0;n=[];for(p=0,k=q.length;p<k;p++){l=q[p];n.push([s+(m++*o),l])}return n};j.prototype.wrap=function(k,l){if(l==null){l=true}if(l){this.validate(k)}return new f(k)};j.prototype.numeric=function(k,l){if(l==null){l=true}if(l){this.validate(k);if(typeof k[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}}return new a(k)};j.prototype.multi=function(k,l){if(l==null){l=true}if(l){this.validate(k)}return new e(k)};j.prototype.build=function(k){this.validate(k);if(typeof k[0][1]==="number"){return this.numeric(k)}else{if(typeof k[0][1]==="string"){return this.wrap(k)}else{return this.multi(k)}}};j.prototype.buffer=function(k){if(k==null){k=[]}return new c(k)};return j})();d=new i();c=(function(){function j(k){this.data=k!=null?k:[]}j.prototype.append=function(k){if(!(k instanceof Array)){throw"Buffer.append expects array: [t,v] or [[t,v],[t,v]]"}if(k[0] instanceof Array){return this.data=this.data.concat(k)}else{return this.data.push(k)}};j.prototype.shift=function(l){var k;k=this.data.slice(0,l);this.data=this.data.slice(l,this.size());return k};j.prototype.size=function(){return this.data.length};return j})();f=(function(){function j(k){this.data=k;this.squelched=false;this.listeners=[]}j.prototype.size=function(){return this.data.length};j.prototype.length=function(){return this.data.length};j.prototype.count=function(){return this.data.length};j.prototype.first=function(){return this.data[0]};j.prototype.last=function(){return this.data[this.size()-1]};j.prototype.sample=function(k){return this.data[k]};j.prototype.time=function(k){return this.data[k][0]};j.prototype.value=function(k){return this.data[k][1]};j.prototype.domain=function(){return[this.first()[0],this.last()[0]]};j.prototype.shift=function(){var k;k=this.data.shift();this.notify();return k};j.prototype.slide=function(m,l){var k;k=this.data.shift();this.append(m,l);return k};j.prototype.pop=function(){return this.shift()};j.prototype.append=function(l,k){if(l<this.end()){throw"Can't append sample with past timestamp"}this.data.push([l,k]);return this.notify()};j.prototype.push=function(l,k){return this.append(l,k)};j.prototype.add=function(l,k){return this.append(l,k)};j.prototype.pushpop=function(m,l,k){if(k==null){k=0}this.squelched=true;this.append(m,l);if(k>0){while(this.size()>k){this.shift()}}this.squelched=false;return this.notify()};j.prototype.streambuf=function(k,m){var l=this;if(k==null){k=60}if(m==null){m=0}this.buffer=$ts.buffer();this.interval=setInterval(function(){var y,w,u,q,o,s,r,p,n;if(l.buffer.size()===0){return}l.squelched=true;r=l.buffer.shift(Math.ceil(l.buffer.size()/k));for(q=0,s=r.length;q<s;q++){p=r[q],y=p[0],w=p[1];l.append(y,w)}if(l.size()>m){for(u=o=0,n=l.size()-m;0<=n?o<=n:o>=n;u=0<=n?++o:--o){l.shift()}}l.squelched=false;return l.notify()},1000/k);return this.buffer};j.prototype.notify=function(){var o,n,l,m,k;if(this.squelched){return}m=this.listeners;k=[];for(n=0,l=m.length;n<l;n++){o=m[n];k.push(o())}return k};j.prototype.listen=function(k){return this.listeners.push(k)};j.prototype.values=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(m)}return o};j.prototype.duration=function(){return this.end()-this.start()};j.prototype.start=function(){return this.first()[0]};j.prototype.end=function(){return this.last()[0]};j.prototype.scan=function(n,m){var l,k;l=this.nearest(n);k=this.nearest(m);if(this.time(l)<n){++l}if(this.time(k)<m){++k}return new this.constructor(this.data.slice(l,k))};j.prototype.filter=function(m){var n,l,p,k,o;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){l=o[p];if(m(l[0],l[1])){n.push(l)}}return new this.constructor(n)};j.prototype.split=function(q){var m,l,n,p,k,o;m=[];l=[];o=this.data;for(p=0,k=o.length;p<k;p++){n=o[p];if(n[0]<=q){m.push(n)}else{l.push(n)}}return[new this.constructor(m),new this.constructor(l)]};j.prototype.map=function(m){var n,l,p,k,o;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){l=o[p];n.push(m(l[0],l[1]))}return new this.constructor(n)};j.prototype.timestamps=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(n)}return o};j.prototype.nearest=function(k){return this.bsearch(k,0,this.size()-1)};j.prototype.bsearch=function(n,m,k){var p,o,l;l=Math.floor((k-m)/2)+m;if(m===l){p=Math.abs(this.time(m)-n);o=Math.abs(this.time(k)-n);if(o>p){return m}else{return k}}else{if(n<this.time(l)){return this.bsearch(n,m,l)}else{if(n>this.time(l)){return this.bsearch(n,l,k)}else{return l}}}};j.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return j})();a=(function(k){b(j,k);function j(l){this.data=l;j.__super__.constructor.call(this,this.data)}j.prototype.statistics=function(){var q,n,p,u,s,m,r,o,l;if(this._stats){return this._stats}p=0;n=Infinity;q=-Infinity;o=this.data;for(m=0,r=o.length;m<r;m++){l=o[m],u=l[0],s=l[1];p+=s;if(s>q){q=s}if(s<n){n=s}}return this._stats={sum:p,min:n,max:q}};j.prototype.shift=function(){var u,w,r,z,y,q,p,x,l,s,o,n,m;u=this.data.shift();y=u[1];if(this._stats){this._stats.sum-=y;if(y===this._stats.min){r=Infinity;s=this.data;for(q=0,x=s.length;q<x;q++){o=s[q],z=o[0],y=o[1];r=Math.min(y,r)}this._stats.min=r}if(y===this._stats.max){w=-Infinity;n=this.data;for(p=0,l=n.length;p<l;p++){m=n[p],z=m[0],y=m[1];w=Math.max(y,w)}this._stats.max=w}}this.notify();return u};j.prototype.append=function(m,l){if(m<this.end()){throw"Can't append sample with past timestamp"}if(this._stats){this._stats.sum+=l;this._stats.min=Math.min(this._stats.min,l);this._stats.max=Math.max(this._stats.max,l)}return j.__super__.append.call(this,m,l)};j.prototype.sum=function(){return this.statistics().sum};j.prototype.sumsq=function(){var p,o,l,y,x,s,w,u,q;p=this.mean();l=0;u=this.data;for(s=0,w=u.length;s<w;s++){q=u[s],y=q[0],x=q[1];o=x-p;l+=o*o}return l};j.prototype.variance=function(){return this.sumsq()/(this.size()-1)};j.prototype.stddev=function(){return Math.sqrt(this.variance())};j.prototype.mean=function(){return this.sum()/this.size()};j.prototype.range=function(){return[this.min(),this.max()]};j.prototype.span=function(){return this.max()-this.min()};j.prototype.min=function(){return this.statistics().min};j.prototype.max=function(){return this.statistics().max};j.prototype.values=function(){var p,o,n,s,m,q,l;p=[];q=this.data;for(s=0,m=q.length;s<m;s++){l=q[s],o=l[0],n=l[1];p.push(n)}return p};j.prototype.valuesSorted=function(){if(this._valuesSorted){return this._valuesSorted}return this._valuesSorted=this.values().sort(function(m,l){return m-l})};j.prototype.median=function(){var l;l=Math.floor(this.size()/2);if(this.size()%2){return this.valuesSorted()[l]}else{return(this.valuesSorted()[l-1]+this.valuesSorted()[l])/2}};j.prototype.rollup=function(o,s,y){var w,A,l,z,m,x,p,u,q,n,r=this;if(y==null){y=false}m=this.start()-(this.start()%o);A=[];w=[];q=this.data;for(p=0,u=q.length;p<u;p++){n=q[p],z=n[0],x=n[1];while(z-m>=o){A.push([m,s(m,w)]);w=[];m+=o}w.push([x])}if(w.length>0){A.push([m,s(m,w)])}l=d.build(A);if(y){m+=o;setInterval(function(){w=r.scan(m,m+o);if(w.size()>0){l.slide(m,s(m,w))}return m+=o},o)}return l};j.prototype.norms=function(){var p,o,n,s,m,q,l;p=[];q=this.data;for(s=0,m=q.length;s<m;s++){l=q[s],o=l[0],n=l[1];p.push((n-this.mean())/this.stddev())}return p};j.prototype.simplify=function(l){var q,p,n,o,t,m,s;if(l==null){l=0.1}q=this.first();n=this.max()-this.min();p=[q];s=this.data;for(t=0,m=s.length;t<m;t++){o=s[t];if(((Math.abs(o[1]-q[1]))/n)>l){if(q[0]!==p[p.length-1][0]){p.push(q)}p.push(o)}q=o}if(q[0]!==p[p.length-1][0]){p.push(q)}return d.build(p)};j.prototype.match=function(r){var n,m,q,t,s,l,o,p;if(!(r instanceof f)){throw"Must match against a Timeseries object"}n=999999999;t=-1;s=r.norms();l=this.norms();if(!(s.length<=l.length)){throw"Query length exceeds source length"}for(q=o=0,p=l.length-s.length-1;0<=p?o<=p:o>=p;q=0<=p?++o:--o){m=this._distance(s,l.slice(q,+(q+s.length)+1||9000000000));if(m<n){n=m;t=q}}return t};j.prototype._distance=function(m,l){var r,n,o,q,p;if(m.length!==l.length){throw"Array lengths must match for distance"}o=0;for(n=q=0,p=m.length-1;0<=p?q<=p:q>=p;n=0<=p?++q:--q){r=l[n]-m[n];o+=r*r}return Math.sqrt(o)};j.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return j})(f);e=(function(k){b(j,k);function j(s){var o,m,r,q,n,p,l;this.data=s;j.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];for(q=0,n=s.length;q<n;q++){m=s[q];p=m[1];for(o in p){r=p[o];if(!this.lookup.hasOwnProperty(o)){this.lookup[o]=[];this.attrs.push(o)}this.lookup[o].push([m[0],r])}}l=this.lookup;for(o in l){r=l[o];this.lookup[o]=d.build(this.lookup[o])}}j.prototype.series=function(l){var m,n;if(l[0]==="/"){return this.series(l.substr(1))}if(l.indexOf("/")>0){n=l.split("/");m=n.shift();if(!this.lookup[m]){throw"Can't get attribute "+m+" of multi time series"}return this.lookup[m].series(n.join("/"))}if(!this.lookup[l]){throw"Can't get attribute "+l+" of multi time series"}return this.lookup[l]};j.prototype.slide=function(n,l){var m,o;for(m in l){o=l[m];this.lookup[m].slide(n,o)}return j.__super__.slide.call(this,n,l)};j.prototype.append=function(n,l){var m,o;for(m in l){o=l[m];if(this.lookup.hasOwnProperty(m)){this.lookup[m].append(n,o)}else{this.lookup[m]=d.build([[n,o]]);this.attrs.push(m)}}return j.__super__.append.call(this,n,l)};j.prototype.shift=function(){var l,o,m,n;n=this.attrs;for(o=0,m=n.length;o<m;o++){l=n[o];this.lookup[l].shift()}return j.__super__.shift.call(this)};j.prototype.attr=function(l){return this.series(l)};j.prototype.serieses=function(){return this.attrs};return j})(f);h=typeof module!=="undefined"&&module.exports?module.exports:window;h.$ts=d}).call(this);