(function(){var e,b,a,f,i,d,h,g={}.hasOwnProperty,c=function(m,k){for(var j in k){if(g.call(k,j)){m[j]=k[j]}}function l(){this.constructor=m}l.prototype=k.prototype;m.prototype=new l();m.__super__=k.prototype;return m};i=(function(){function j(){}j.prototype.validate=function(k){if(k.length===0){throw"Timeseries expects an array of data."}if(k[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof k[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};j.prototype.timestamp=function(q,s,o){var m,n,l,p,k;if(s==null){s=new Date().getTime()}if(o==null){o=60000}m=0;n=[];for(p=0,k=q.length;p<k;p++){l=q[p];n.push([s+(m++*o),l])}return n};j.prototype.wrap=function(k){this.validate(k);return new f(k)};j.prototype.numeric=function(k){this.validate(k);if(typeof k[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}return new b(k)};j.prototype.multi=function(k){this.validate(k);return new e(k)};j.prototype.build=function(k){this.validate(k);if(typeof k[0][1]==="number"){return this.numeric(k)}else{if(typeof k[0][1]==="string"){return this.wrap(k)}else{return this.multi(k)}}};return j})();d=new i();a=(function(){function j(n,l,m){var o,k;this.width=n;this.height=l;o=m.domain(),this.t1=o[0],this.t2=o[1];k=m.range(),this.min=k[0],this.max=k[1]}j.prototype.x=function(k){return((k-this.t1)/(this.t2-this.t1))*this.width};j.prototype.y=function(k){return this.height-((k-this.min)/(this.max-this.min))*this.height};j.prototype.rx=function(k){return(k/this.width)*(this.t2-this.t1)+this.t1};return j})();f=(function(){function j(k){this.data=k}j.prototype.size=function(){return this.data.length};j.prototype.length=function(){return this.data.length};j.prototype.count=function(){return this.data.length};j.prototype.first=function(){return this.data[0]};j.prototype.last=function(){return this.data[this.size()-1]};j.prototype.sample=function(k){return this.data[k]};j.prototype.time=function(k){return this.data[k][0]};j.prototype.value=function(k){return this.data[k][1]};j.prototype.domain=function(){return[this.first()[0],this.last()[0]]};j.prototype.append=function(l,k){return this.data.push([l,k])};j.prototype.values=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(m)}return o};j.prototype.duration=function(){return this.end()-this.start()};j.prototype.start=function(){return this.first()[0]};j.prototype.end=function(){return this.last()[0]};j.prototype.scan=function(n,m){var l,k;l=this.nearest(n);k=this.nearest(m);if(l===this.size()-1){l++}if(k===this.size()-1){k++}return new this.constructor(this.data.slice(l,k))};j.prototype.filter=function(m){var n,l,p,k,o;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){l=o[p];if(m(l[0],l[1])){n.push(l)}}return new this.constructor(n)};j.prototype.map=function(m){var n,l,p,k,o;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){l=o[p];n.push(m(l[0],l[1]))}return new this.constructor(n)};j.prototype.timestamps=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(n)}return o};j.prototype.nearest=function(k){return this.bsearch(k,0,this.size()-1)};j.prototype.bsearch=function(n,m,k){var p,o,l;l=Math.floor((k-m)/2)+m;if(m===l){p=Math.abs(this.time(m)-n);o=Math.abs(this.time(k)-n);if(o>p){return m}else{return k}}else{if(n<this.time(l)){return this.bsearch(n,m,l)}else{if(n>this.time(l)){return this.bsearch(n,l,k)}else{return l}}}};j.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return j})();b=(function(k){c(j,k);function j(l){this.data=l;j.__super__.constructor.call(this,this.data)}j.prototype.statistics=function(){var r,o,q,m,w,u,n,s,p,l;if(this._stats){return this._stats}q=0;m=0;o=999999999999;r=-o;p=this.data;for(n=0,s=p.length;n<s;n++){l=p[n],w=l[0],u=l[1];q+=u;m+=u*u;if(u>r){r=u}if(u<o){o=u}}return this._stats={sum:q,min:o,max:r,sum2:m}};j.prototype.sum=function(){return this.statistics().sum};j.prototype.sumsq=function(){return this.statistics().sum2};j.prototype.variance=function(){var w,q,p,o,u,m,s,l;q=0;s=this.data;for(u=0,m=s.length;u<m;u++){l=s[u],p=l[0],o=l[1];w=o-this.mean();q+=w*w}return q/(this.size()-1)};j.prototype.stddev=function(){return Math.sqrt((this.sumsq()/this.size())/(this.mean()*this.mean()))};j.prototype.mean=function(){return this.sum()/this.size()};j.prototype.range=function(){return[this.min(),this.max()]};j.prototype.span=function(){return this.max()-this.min()};j.prototype.min=function(){return this.statistics().min};j.prototype.max=function(){return this.statistics().max};j.prototype.values=function(){var p,o,n,s,m,q,l;p=[];q=this.data;for(s=0,m=q.length;s<m;s++){l=q[s],o=l[0],n=l[1];p.push(n)}return p};j.prototype.scale=function(m,l){var n;n=new a(m,l,this);return this.map(function(p,o){return[n.x(p),n.y(o)]})};j.prototype.norms=function(){var p,o,n,s,m,q,l;p=[];q=this.data;for(s=0,m=q.length;s<m;s++){l=q[s],o=l[0],n=l[1];p.push((n-this.mean())/this.stddev())}return p};j.prototype.simplify=function(l){var q,p,n,o,t,m,s;if(l==null){l=0.1}q=this.first();n=this.max()-this.min();p=[q];s=this.data;for(t=0,m=s.length;t<m;t++){o=s[t];if(((Math.abs(o[1]-q[1]))/n)>l){if(q[0]!==p[p.length-1][0]){p.push(q)}p.push(o)}q=o}if(q[0]!==p[p.length-1][0]){p.push(q)}return new f(p)};j.prototype.match=function(r){var n,m,q,t,s,l,o,p;if(!(r instanceof f)){throw"Must match against a Timeseries object"}n=999999999;t=-1;s=r.norms();l=this.norms();if(!(s.length<=l.length)){throw"Query length exceeds source length"}for(q=o=0,p=l.length-s.length-1;0<=p?o<=p:o>=p;q=0<=p?++o:--o){m=this._distance(s,l.slice(q,+(q+s.length)+1||9000000000));if(m<n){n=m;t=q}}return t};j.prototype._distance=function(p,n){var l,q,o,r,m;q=0;l=0;for(r=0,m=p.length;r<m;r++){o=p[r];q+=(n[l]-o)*(n[l]-o);l++}return q};j.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return j})(f);e=(function(k){c(j,k);function j(o){var t,s,r,n,q,p,m,l;this.data=o;j.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];p=o[0][1];for(t in p){r=p[t];this.attrs.push(t);this.lookup[t]=[]}for(n=0,q=o.length;n<q;n++){s=o[n];m=s[1];for(t in m){r=m[t];this.lookup[t].push([s[0],r])}}l=this.lookup;for(t in l){r=l[t];if(typeof this.lookup[t][0][1]==="number"){this.lookup[t]=d.numeric(this.lookup[t])}else{this.lookup[t]=d.multi(this.lookup[t])}}}j.prototype.series=function(l){var m,n;if(l[0]==="/"){return this.series(l.substr(1))}if(l.indexOf("/")>0){n=l.split("/");m=n.shift();if(!this.lookup[m]){throw"Can't get attribute "+m+" of multi time series"}return this.lookup[m].series(n.join("/"))}if(!this.lookup[l]){throw"Can't get attribute "+l+" of multi time series"}return this.lookup[l]};j.prototype.attr=function(l){return this.series(l)};return j})(f);h=typeof module!=="undefined"&&module.exports?module.exports:window;h.$ts=d}).call(this);