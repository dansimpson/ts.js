(function(){var f,e,d,h,b,a,c={}.hasOwnProperty,g=function(l,j){for(var i in j){if(c.call(j,i)){l[i]=j[i]}}function k(){this.constructor=l}k.prototype=j.prototype;l.prototype=new k();l.__super__=j.prototype;return l};h=(function(){function i(){}i.prototype.validate=function(j){if(j.length===0){throw"Timeseries expects an array of data."}if(j[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof j[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};i.prototype.timestamp=function(p,q,n){var l,m,k,o,j;if(q==null){q=new Date().getTime()}if(n==null){n=60000}l=0;m=[];for(o=0,j=p.length;o<j;o++){k=p[o];m.push([q+(l++*n),k])}return m};i.prototype.wrap=function(j){this.validate(j);return new d(j)};i.prototype.numeric=function(j){this.validate(j);if(typeof j[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}return new e(j)};i.prototype.multi=function(j){this.validate(j);return new f(j)};i.prototype.build=function(j){this.validate(j);if(typeof j[0][1]==="number"){return this.numeric(j)}else{if(typeof j[0][1]==="string"){return this.wrap(j)}else{return this.multi(j)}}};return i})();b=new h();d=(function(){function i(j){this.data=j}i.prototype.size=function(){return this.data.length};i.prototype.length=function(){return this.data.length};i.prototype.count=function(){return this.data.length};i.prototype.first=function(){return this.data[0]};i.prototype.last=function(){return this.data[this.size()-1]};i.prototype.sample=function(j){return this.data[j]};i.prototype.time=function(j){return this.data[j][0]};i.prototype.value=function(j){return this.data[j][1]};i.prototype.domain=function(){return[this.first()[0],this.last()[0]]};i.prototype.append=function(k,j){return this.data.push([k,j])};i.prototype.values=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(l)}return n};i.prototype.scan=function(m,l){var k,j;k=this.nearest(m);j=this.nearest(l);if(k===this.size()-1){k++}if(j===this.size()-1){j++}return new this.constructor(this.data.slice(k,j))};i.prototype.filter=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];if(l(k[0],k[1])){m.push(k)}}return new this.constructor(m)};i.prototype.map=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];m.push(l(k[0],k[1]))}return new this.constructor(m)};i.prototype.timestamps=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(m)}return n};i.prototype.nearest=function(j){return this.bsearch(j,0,this.size()-1)};i.prototype.bsearch=function(m,l,j){var o,n,k;k=Math.floor((j-l)/2)+l;if(l===k){o=Math.abs(this.time(l)-m);n=Math.abs(this.time(j)-m);if(n>o){return l}else{return j}}else{if(m<this.time(k)){return this.bsearch(m,l,k)}else{if(m>this.time(k)){return this.bsearch(m,k,j)}else{return k}}}};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return i})();e=(function(j){g(i,j);function i(k){this.data=k;i.__super__.constructor.call(this,this.data)}i.prototype.statistics=function(){var q,n,p,l,u,s,m,r,o,k;if(this._stats){return this._stats}p=0;l=0;n=999999999999;q=-n;o=this.data;for(m=0,r=o.length;m<r;m++){k=o[m],u=k[0],s=k[1];p+=s;l+=s*s;if(s>q){q=s}if(s<n){n=s}}return this._stats={sum:p,min:n,max:q,sum2:l}};i.prototype.sum=function(){return this.statistics().sum};i.prototype.sumsq=function(){return this.statistics().sum2};i.prototype.variance=function(){var u,p,o,m,s,l,q,k;p=0;q=this.data;for(s=0,l=q.length;s<l;s++){k=q[s],o=k[0],m=k[1];u=m-this.mean();p+=u*u}return p/(this.size()-1)};i.prototype.stddev=function(){return Math.sqrt((this.sumsq()/this.size())/(this.mean()*this.mean()))};i.prototype.mean=function(){return this.sum()/this.size()};i.prototype.range=function(){return[this.min(),this.max()]};i.prototype.min=function(){return this.statistics().min};i.prototype.max=function(){return this.statistics().max};i.prototype.values=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(m)}return o};i.prototype.norms=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push((m-this.mean())/this.stddev())}return o};i.prototype.simplify=function(k){var p,o,m,n,s,l,q;if(k==null){k=0.1}p=this.first();m=this.max()-this.min();o=[p];q=this.data;for(s=0,l=q.length;s<l;s++){n=q[s];if(((Math.abs(n[1]-p[1]))/m)>k){if(p[0]!==o[o.length-1][0]){o.push(p)}o.push(n)}p=n}if(p[0]!==o[o.length-1][0]){o.push(p)}return new d(o)};i.prototype.match=function(q){var m,l,p,s,r,k,n,o;if(!(q instanceof d)){throw"Must match against a Timeseries object"}m=999999999;s=-1;r=q.norms();k=this.norms();if(!(r.length<=k.length)){throw"Query length exceeds source length"}for(p=n=0,o=k.length-r.length-1;0<=o?n<=o:n>=o;p=0<=o?++n:--n){l=this._distance(r,k.slice(p,+(p+r.length)+1||9000000000));if(l<m){m=l;s=p}}return s};i.prototype._distance=function(o,m){var k,p,n,q,l;p=0;k=0;for(q=0,l=o.length;q<l;q++){n=o[q];p+=(m[k]-n)*(m[k]-n);k++}return p};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return i})(d);f=(function(j){g(i,j);function i(n){var s,r,q,m,p,o,l,k;this.data=n;i.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];o=n[0][1];for(s in o){q=o[s];this.attrs.push(s);this.lookup[s]=[]}for(m=0,p=n.length;m<p;m++){r=n[m];l=r[1];for(s in l){q=l[s];this.lookup[s].push([r[0],q])}}k=this.lookup;for(s in k){q=k[s];if(typeof this.lookup[s][0][1]==="number"){this.lookup[s]=b.numeric(this.lookup[s])}else{this.lookup[s]=b.multi(this.lookup[s])}}}i.prototype.series=function(k){var l,m;if(k.indexOf("/")>-1){m=k.split("/");if(m[0]===""){m.shift()}l=m.shift();if(!this.lookup[l]){throw"Can't get attribute "+k+" of multi time series"}return this.lookup[l].series(m.join("/"))}if(!this.lookup[k]){throw"Can't get attribute "+k+" of multi time series"}return this.lookup[k]};i.prototype.attr=function(k){return this.series(k)};return i})(d);a=typeof module!=="undefined"&&module.exports?module.exports:window;a.$ts=b}).call(this);