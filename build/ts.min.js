(function(){var f,e,d,h,b,a,c={}.hasOwnProperty,g=function(l,j){for(var i in j){if(c.call(j,i)){l[i]=j[i]}}function k(){this.constructor=l}k.prototype=j.prototype;l.prototype=new k();l.__super__=j.prototype;return l};h=(function(){function i(){}i.prototype.validate=function(j){if(j.length===0){throw"Timeseries expects an array of data."}if(j[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof j[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};i.prototype.timestamp=function(p,q,n){var l,m,k,o,j;if(q==null){q=new Date().getTime()}if(n==null){n=60000}l=0;m=[];for(o=0,j=p.length;o<j;o++){k=p[o];m.push([q+(l++*n),k])}return m};i.prototype.wrap=function(j,k){if(k==null){k=true}if(k){this.validate(j)}return new d(j)};i.prototype.numeric=function(j,k){if(k==null){k=true}if(k){this.validate(j);if(typeof j[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}}return new e(j)};i.prototype.multi=function(j,k){if(k==null){k=true}if(k){this.validate(j)}return new f(j)};i.prototype.build=function(j){this.validate(j);if(typeof j[0][1]==="number"){return this.numeric(j)}else{if(typeof j[0][1]==="string"){return this.wrap(j)}else{return this.multi(j)}}};return i})();b=new h();d=(function(){function i(j){this.data=j;this.squelched=false;this.listeners=[];this.init_listeners=[];this.timeframe=null}i.prototype.size=function(){return this.data.length};i.prototype.empty=function(){return this.data.length===0};i.prototype.length=function(){return this.data.length};i.prototype.count=function(){return this.data.length};i.prototype.slice_indices=function(m,l){var k,j;k=this.nearest(m);j=this.nearest(l);if(this.time(k)<m){++k}if(this.time(j)<l){++j}return[k,j]};i.prototype.limit=function(j){this.timeframe=j;return this};i.prototype.behead=function(){var l,k,j;if(this.timeframe===null){return[]}j=this.end()-this.timeframe;l=0;while(this.data[l][0]<j){l++}k=this.data.slice(0,l);this.data=this.data.slice(l);return k};i.prototype.first=function(){return this.data[0]};i.prototype.last=function(){return this.data[this.size()-1]};i.prototype.sample=function(j){return this.data[j]};i.prototype.time=function(j){return this.data[j][0]};i.prototype.value=function(j){return this.data[j][1]};i.prototype.domain=function(){return[this.first()[0],this.last()[0]]};i.prototype.append=function(k,j){if(this.empty()){this.data.push([k,j]);return}if(k<this.end()){throw"Can't append sample with past timestamp"}this.data.push([k,j]);this.behead();return this.notify()};i.prototype.push=function(k,j){return this.append(k,j)};i.prototype.add=function(k,j){return this.append(k,j)};i.prototype.notify=function(){var q,p,n,m,l,o,j,k;if(this.squelched){return}if(this.size()===2){o=this.init_listeners;for(p=0,m=o.length;p<m;p++){q=o[p];q()}}j=this.listeners;k=[];for(n=0,l=j.length;n<l;n++){q=j[n];k.push(q())}return k};i.prototype.listen=function(j){return this.listeners.push(j)};i.prototype.on_init=function(j){return this.init_listeners.push(j)};i.prototype.values=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(l)}return n};i.prototype.duration=function(){return this.end()-this.start()};i.prototype.start=function(){return this.first()[0]};i.prototype.end=function(){return this.last()[0]};i.prototype.scan=function(m,l){var k,j,n;n=this.slice_indices(m,l),k=n[0],j=n[1];return new this.constructor(this.data.slice(k,j))};i.prototype.filter=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];if(l(k[0],k[1])){m.push(k)}}return new this.constructor(m)};i.prototype.split=function(p){var l,k,m,o,j,n;l=[];k=[];n=this.data;for(o=0,j=n.length;o<j;o++){m=n[o];if(m[0]<=p){l.push(m)}else{k.push(m)}}return[new this.constructor(l),new this.constructor(k)]};i.prototype.partition=function(l){var o,s,r,j,q,m,p,n,k;j=this.start()-Math.abs(this.start()%l);s=[];o=[];n=this.data;for(m=0,p=n.length;m<p;m++){k=n[m],r=k[0],q=k[1];while(r-j>=l){s.push([j,b.build(o)]);o=[];j+=l}o.push([r,q])}if(o.length>0){s.push([j,b.build(o)])}return b.wrap(s,false)};i.prototype.map=function(l){var m,k,o,j,n;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){k=n[o];m.push(l(k[0],k[1]))}return b.build(m)};i.prototype.pfold=function(k,j){return this.partition(k).map(j)};i.prototype.timestamps=function(){var n,m,l,p,k,o,j;n=[];o=this.data;for(p=0,k=o.length;p<k;p++){j=o[p],m=j[0],l=j[1];n.push(m)}return n};i.prototype.nearest=function(k,l){var j;if(l==null){l=false}if(k<=this.start()){return 0}if(k>=this.end()){return this.size()-1}j=this.bsearch(k,0,this.size()-1);if(l&&this.time(j)>k){j=Math.max(0,j-1)}return j};i.prototype.bsearch=function(m,l,j){var o,n,k;k=Math.floor((j-l)/2)+l;if(l===k){o=Math.abs(this.time(l)-m);n=Math.abs(this.time(j)-m);if(n>o){return l}else{return j}}else{if(m<this.time(k)){return this.bsearch(m,l,k)}else{if(m>this.time(k)){return this.bsearch(m,k,j)}else{return k}}}};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return i})();e=(function(j){g(i,j);function i(k){this.data=k;i.__super__.constructor.call(this,this.data)}i.prototype.statistics=function(){var p,m,o,s,r,l,q,n,k;if(this._stats){return this._stats}o=0;m=Infinity;p=-Infinity;n=this.data;for(l=0,q=n.length;l<q;l++){k=n[l],s=k[0],r=k[1];o+=r;if(r>p){p=r}if(r<m){m=r}}return this._stats={sum:o,min:m,max:p}};i.prototype.behead=function(){var n,m,l,p,k,o;n=i.__super__.behead.call(this);if(n.length===0||!this._stats){return}for(p=0,k=n.length;p<k;p++){o=n[p],m=o[0],l=o[1];this._stats.sum-=l;if(l===this._stats.min||l===this._stats.max){this._stats=false;return}}};i.prototype.append=function(l,k){if(l<this.end()){throw"Can't append sample with past timestamp"}if(this._stats){this._stats.sum+=k;this._stats.min=Math.min(this._stats.min,k);this._stats.max=Math.max(this._stats.max,k)}return i.__super__.append.call(this,l,k)};i.prototype.sum=function(){return this.statistics().sum};i.prototype.sumsq=function(){var o,l,k,x,w,q,u,s,p;o=this.mean();k=0;s=this.data;for(q=0,u=s.length;q<u;q++){p=s[q],x=p[0],w=p[1];l=w-o;k+=l*l}return k};i.prototype.variance=function(){return this.sumsq()/(this.size()-1)};i.prototype.stddev=function(){return Math.sqrt(this.variance())};i.prototype.mean=function(){return this.sum()/this.size()};i.prototype.range=function(){return[this.min(),this.max()]};i.prototype.span=function(){return this.max()-this.min()};i.prototype.min=function(){return this.statistics().min};i.prototype.max=function(){return this.statistics().max};i.prototype.values=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push(m)}return o};i.prototype.valuesSorted=function(){if(this._valuesSorted){return this._valuesSorted}return this._valuesSorted=this.values().sort(function(l,k){return l-k})};i.prototype.quartiles=function(){return{min:this.min(),p25:this.p25th(),mid:this.median(),p75:this.p75th(),max:this.max()}};i.prototype.p25th=function(){return this.percentile(0.25)};i.prototype.p75th=function(){return this.percentile(0.75)};i.prototype.median=function(){return this.percentile(0.5)};i.prototype.percentile=function(l){var k;k=Math.floor(this.size()*l);if(this.size()%2){return this.valuesSorted()[k]}else{return(this.valuesSorted()[k-1]+this.valuesSorted()[k])/2}};i.prototype.norms=function(){var o,n,m,q,l,p,k;o=[];p=this.data;for(q=0,l=p.length;q<l;q++){k=p[q],n=k[0],m=k[1];o.push((m-this.mean())/this.stddev())}return o};i.prototype.simplify=function(k){var p,o,m,n,s,l,q;if(k==null){k=0.1}p=this.first();m=this.max()-this.min();o=[p];q=this.data;for(s=0,l=q.length;s<l;s++){n=q[s];if(((Math.abs(n[1]-p[1]))/m)>k){if(p[0]!==o[o.length-1][0]){o.push(p)}o.push(n)}p=n}if(p[0]!==o[o.length-1][0]){o.push(p)}return b.build(o)};i.prototype.match=function(q){var m,l,p,s,r,k,n,o;if(!(q instanceof d)){throw"Must match against a Timeseries object"}m=999999999;s=-1;r=q.norms();k=this.norms();if(!(r.length<=k.length)){throw"Query length exceeds source length"}for(p=n=0,o=k.length-r.length-1;0<=o?n<=o:n>=o;p=0<=o?++n:--n){l=this._distance(r,k.slice(p,+(p+r.length)+1||9000000000));if(l<m){m=l;s=p}}return s};i.prototype._distance=function(l,k){var q,m,n,p,o;if(l.length!==k.length){throw"Array lengths must match for distance"}n=0;for(m=p=0,o=l.length-1;0<=o?p<=o:p>=o;m=0<=o?++p:--p){q=k[m]-l[m];n+=q*q}return Math.sqrt(n)};i.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return i})(d);f=(function(j){g(i,j);function i(r){var n,l,q,p,m,o,k;this.data=r;i.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];for(p=0,m=r.length;p<m;p++){l=r[p];o=l[1];for(n in o){q=o[n];if(!this.lookup.hasOwnProperty(n)){this.lookup[n]=[];this.attrs.push(n)}this.lookup[n].push([l[0],q])}}k=this.lookup;for(n in k){q=k[n];this.lookup[n]=b.build(this.lookup[n])}}i.prototype.series=function(k){var l,m;if(k[0]==="/"){return this.series(k.substr(1))}if(k.indexOf("/")>0){m=k.split("/");l=m.shift();if(!this.lookup[l]){return null}return this.lookup[l].series(m.join("/"))}if(!this.lookup[k]){return null}return this.lookup[k]};i.prototype.get=function(k){return this.series(k)};i.prototype.limit=function(o){var l,m,n,k;i.__super__.limit.call(this,o);n=this.lookup;k=[];for(l in n){m=n[l];k.push(m.limit(o))}return k};i.prototype.append=function(m,k){var l,n;for(l in k){n=k[l];if(this.lookup.hasOwnProperty(l)){this.lookup[l].append(m,n)}else{this.lookup[l]=b.build([[m,n]]);this.attrs.push(l)}}return i.__super__.append.call(this,m,k)};i.prototype.attr=function(k){return this.series(k)};i.prototype.serieses=function(){return this.attrs};i.prototype.min=function(){var k,l,n,m;l=[];m=this.lookup;for(k in m){n=m[k];l.push(n.min())}return Math.min.apply(Math,l)};i.prototype.max=function(){var l,k,n,m;k=[];m=this.lookup;for(l in m){n=m[l];k.push(n.max())}return Math.max.apply(Math,k)};i.prototype.exists=function(k){return this.series(k)!==null};return i})(d);a=typeof module!=="undefined"&&module.exports?module.exports:window;a.$ts=b}).call(this);