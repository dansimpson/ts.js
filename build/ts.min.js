(function(){var d,c,b,f,a={}.hasOwnProperty,e=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};f=(function(){function g(){}g.prototype.validate=function(h){if(h.length===0){throw"Timeseries expects an array of data."}if(h[0].length!==2){throw"Timeseries expects input like [[timestamp, value]...]"}if(typeof h[0][0]!=="number"){throw"Timeseries expects timestamps; eg: [[timestamp, value]...]"}};g.prototype.timestamp=function(o,p,m){var k,l,j,n,h;if(p==null){p=new Date().getTime()}if(m==null){m=60000}k=0;l=[];for(n=0,h=o.length;n<h;n++){j=o[n];l.push([p+(k++*m),j])}return l};g.prototype.wrap=function(h){this.validate(h);return new b(h)};g.prototype.numeric=function(h){this.validate(h);if(typeof h[0][1]!=="number"){throw"NumericTimeseries expects timestamps and numbers; eg: [[timestamp, number]...]"}return new c(h)};g.prototype.multi=function(h){this.validate(h);return new d(h)};g.prototype.build=function(h){this.validate(h);if(typeof h[0][1]==="number"){return this.numeric(h)}else{if(typeof h[0][1]==="string"){return this.wrap(h)}else{return this.multi(h)}}};return g})();b=(function(){function g(h){this.data=h}g.prototype.size=function(){return this.data.length};g.prototype.length=function(){return this.data.length};g.prototype.count=function(){return this.data.length};g.prototype.first=function(){return this.data[0]};g.prototype.last=function(){return this.data[this.size()-1]};g.prototype.sample=function(h){return this.data[h]};g.prototype.time=function(h){return this.data[h][0]};g.prototype.value=function(h){return this.data[h][1]};g.prototype.domain=function(){return[this.first()[0],this.last()[0]]};g.prototype.append=function(i,h){return this.data.push([i,h])};g.prototype.values=function(){var l,k,j,n,i,m,h;l=[];m=this.data;for(n=0,i=m.length;n<i;n++){h=m[n],k=h[0],j=h[1];l.push(j)}return l};g.prototype.scan=function(k,j){var i,h;i=this.nearest(k);h=this.nearest(j);if(i===this.size()-1){i++}if(h===this.size()-1){h++}return new this.constructor(this.data.slice(i,h))};g.prototype.filter=function(j){var k,i,m,h,l;k=[];l=this.data;for(m=0,h=l.length;m<h;m++){i=l[m];if(j(i[0],i[1])){k.push(i)}}return new this.constructor(k)};g.prototype.map=function(j){var k,i,m,h,l;k=[];l=this.data;for(m=0,h=l.length;m<h;m++){i=l[m];k.push(j(i[0],i[1]))}return new this.constructor(k)};g.prototype.timestamps=function(){var l,k,j,n,i,m,h;l=[];m=this.data;for(n=0,i=m.length;n<i;n++){h=m[n],k=h[0],j=h[1];l.push(k)}return l};g.prototype.nearest=function(h){return this.bsearch(h,0,this.size()-1)};g.prototype.bsearch=function(k,j,h){var m,l,i;i=Math.floor((h-j)/2)+j;if(j===i){m=Math.abs(this.time(j)-k);l=Math.abs(this.time(h)-k);if(l>m){return j}else{return h}}else{if(k<this.time(i)){return this.bsearch(k,j,i)}else{if(k>this.time(i)){return this.bsearch(k,i,h)}else{return i}}}};g.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\ndomain  : "+(this.domain())};return g})();c=(function(h){e(g,h);function g(i){this.data=i;g.__super__.constructor.call(this,this.data)}g.prototype.statistics=function(){var o,l,n,j,r,q,k,p,m,i;if(this._stats){return this._stats}n=0;j=0;l=999999999999;o=-l;m=this.data;for(k=0,p=m.length;k<p;k++){i=m[k],r=i[0],q=i[1];n+=q;j+=q*q;if(q>o){o=q}if(q<l){l=q}}return this._stats={sum:n,min:l,max:o,sum2:j}};g.prototype.sum=function(){return this.statistics().sum};g.prototype.sumsq=function(){return this.statistics().sum2};g.prototype.variance=function(){var q,m,l,k,p,j,o,i;m=0;o=this.data;for(p=0,j=o.length;p<j;p++){i=o[p],l=i[0],k=i[1];q=k-this.mean();m+=q*q}return m/(this.size()-1)};g.prototype.stddev=function(){return Math.sqrt((this.sumsq()/this.size())/(this.mean()*this.mean()))};g.prototype.mean=function(){return this.sum()/this.size()};g.prototype.range=function(){return[this.min(),this.max()]};g.prototype.min=function(){return this.statistics().min};g.prototype.max=function(){return this.statistics().max};g.prototype.values=function(){var m,l,k,o,j,n,i;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){i=n[o],l=i[0],k=i[1];m.push(k)}return m};g.prototype.norms=function(){var m,l,k,o,j,n,i;m=[];n=this.data;for(o=0,j=n.length;o<j;o++){i=n[o],l=i[0],k=i[1];m.push((k-this.mean())/this.stddev())}return m};g.prototype.simplify=function(i){var n,m,k,l,p,j,o;if(i==null){i=0.1}n=this.first();k=this.max()-this.min();m=[n];o=this.data;for(p=0,j=o.length;p<j;p++){l=o[p];if(((Math.abs(l[1]-n[1]))/k)>i){if(n[0]!==m[m.length-1][0]){m.push(n)}m.push(l)}n=l}if(n[0]!==m[m.length-1][0]){m.push(n)}return new b(m)};g.prototype.match=function(p){var l,k,o,r,q,j,m,n;if(!(p instanceof b)){throw"Must match against a Timeseries object"}l=999999999;r=-1;q=p.norms();j=this.norms();if(!(q.length<=j.length)){throw"Query length exceeds source length"}for(o=m=0,n=j.length-q.length-1;0<=n?m<=n:m>=n;o=0<=n?++m:--m){k=this._distance(q,j.slice(o,+(o+q.length)+1||9000000000));if(k<l){l=k;r=o}}return r};g.prototype._distance=function(m,k){var i,n,l,o,j;n=0;i=0;for(o=0,j=m.length;o<j;o++){l=m[o];n+=(k[i]-l)*(k[i]-l);i++}return n};g.prototype.toString=function(){return"Timeseries\nitems   : "+(this.size())+"\nmean    : "+(this.mean())+"\nstddev  : "+(this.stddev())+"\ndomain  : "+(this.domain())+"\nrange   : "+(this.range())+"\nvariance: "+(this.variance())};return g})(b);d=(function(h){e(g,h);function g(l){var q,p,o,k,n,m,j,i;this.data=l;g.__super__.constructor.call(this,this.data);this.lookup={};this.attrs=[];m=l[0][1];for(q in m){o=m[q];this.attrs.push(q);this.lookup[q]=[]}for(k=0,n=l.length;k<n;k++){p=l[k];j=p[1];for(q in j){o=j[q];this.lookup[q].push([p[0],o])}}i=this.lookup;for(q in i){o=i[q];if(typeof this.lookup[q][0][1]==="number"){this.lookup[q]=$ts.numeric(this.lookup[q])}else{this.lookup[q]=$ts.multi(this.lookup[q])}}}g.prototype.series=function(i){var j,k;if(i.indexOf("/")>-1){k=i.split("/");if(k[0]===""){k.shift()}j=k.shift();if(!this.lookup[j]){throw"Can't get attribute "+i+" of multi time series"}return this.lookup[j].series(k.join("/"))}if(!this.lookup[i]){throw"Can't get attribute "+i+" of multi time series"}return this.lookup[i]};g.prototype.attr=function(i){return this.series(i)};return g})(b);root.$ts=new f()}).call(this);